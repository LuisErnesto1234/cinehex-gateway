server:
  port: ${SERVER_GATEWAY_PORT:8090}  # ← Agregar valor por defecto

spring:
  application:
    name: cinehex-gateway
  cloud:
    gateway:
      server: # ← NUEVO NODO
        webflux: # ← NUEVO NODO
          routes:
            - id: auth-server-route
              uri: http://${AUTH_HOST:cinehex-auth-server}:${AUTH_SERVER_PORT:9000}
              predicates:
                - Path=/auth/**, /oauth2/**, /login/**, /.well-known/**, /css/**, /js/**, /images/**
              filters:
                - PreserveHostHeader

            - id: cine-api-route
              uri: http://${RESOURCE_HOST:cinehex-resource}:${RESOURCE_PORT:8080}
              predicates:
                - Path=/api/**
              filters:
                - name: CircuitBreaker
                  args:
                    name: cineCircuitBreaker
                    fallbackUri: forward:/fallback/cine

          globalcors:
            cors-configurations:
              '[/**]':
                allowedOrigins: "http://localhost:3000"
                allowedMethods:
                  - GET
                  - POST
                  - PUT
                  - DELETE
                  - OPTIONS
                allowedHeaders: "*"
                allowCredentials: true

# Configuracion de resiliencia
resilience4j:
  circuitbreaker:
    instances:
      cineCircuitBreaker:
        slidingWindowSize: 10
        permittedNumberOfCallsInHalfOpenState: 3
        failureRateThreshold: 50
        waitDurationInOpenState: 10s
        timeoutDuration: 5s

# Configuracion de spring doc
springdoc:
  swagger-ui:
    validator-url: none
    operations-sorter: alpha
    tags-sorter: alpha
    urls:
      - name: 'Auth Server'
        url: /auth/v3/api-docs
      - name: 'Cine API'
        url: /api/v1/public/v3/api-docs
